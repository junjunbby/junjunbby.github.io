<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Space Shooter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            border: 3px solid #0ff;
            box-shadow: 0 0 20px #0ff;
        }

        #gameCanvas {
            display: block;
            background: #000;
        }

        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            color: #0ff;
            font-size: 16px;
            text-shadow: 0 0 5px #0ff;
            pointer-events: none;
        }

        .ui-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .powerup-bar {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .powerup-item {
            background: rgba(0, 255, 255, 0.2);
            padding: 3px 8px;
            border: 1px solid #0ff;
            border-radius: 3px;
            font-size: 12px;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #0ff;
            text-align: center;
        }

        #overlay h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #0ff;
        }

        #overlay p {
            font-size: 18px;
            margin: 10px 0;
        }

        #overlay button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: transparent;
            color: #0ff;
            border: 2px solid #0ff;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }

        #overlay button:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 20px #0ff;
        }

        .hidden {
            display: none !important;
        }

        .controls {
            font-size: 14px;
            margin-top: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div class="ui-row">
                <div>Score: <span id="score">0</span></div>
                <div>High: <span id="highscore">0</span></div>
                <div>Wave: <span id="wave">1</span></div>
            </div>
            <div class="ui-row">
                <div>Lives: <span id="lives">3</span></div>
                <div>Combo: <span id="combo">0</span>x</div>
            </div>
            <div class="powerup-bar" id="powerupBar"></div>
        </div>

        <div id="overlay">
            <h1>SPACE SHOOTER</h1>
            <div class="controls">
                <p><strong>Steuerung:</strong></p>
                <p>WASD / Pfeiltasten - Bewegen</p>
                <p>SPACE - Schießen</p>
                <p>SHIFT - Spezialwaffe (5 Raketen)</p>
            </div>
            <button id="startBtn">START GAME</button>
        </div>
    </div>

    <script>
        // Canvas Setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        // Audio Context für Sound
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // Sound-Funktionen
        function playSound(freq, duration, type = 'sine') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            osc.type = type;
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // Game State
        let gameState = {
            running: false,
            paused: false,
            score: 0,
            highscore: localStorage.getItem('highscore') || 0,
            wave: 1,
            combo: 0,
            comboTimer: 0,
            waveEnemies: 0,
            killedEnemies: 0,
            scrollDistance: 0,
            nextWaveAt: 150
        };

        // Player
        const player = {
            x: W / 2,
            y: H - 80,
            width: 30,
            height: 40,
            speed: 5,
            lives: 3,
            invulnerable: 0,
            missiles: 5,
            missileCooldown: 0,
            powerups: {},
            shootCooldown: 0
        };

        // Arrays
        let keys = {};
        let bullets = [];
        let enemies = [];
        let particles = [];
        let powerups = [];
        let stars = [];

        // Initialisierung der Sterne für Hintergrund
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * W,
                y: Math.random() * H,
                size: Math.random() * 2,
                speed: Math.random() * 2 + 1
            });
        }

        // Tastatur-Event-Handler
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.code === 'Space' && gameState.running) {
                e.preventDefault();
                shoot();
            }
            if (e.key === 'Shift' && gameState.running) {
                e.preventDefault();
                shootMissile();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Start Button
        document.getElementById('startBtn').addEventListener('click', startGame);

        function startGame() {
            document.getElementById('overlay').classList.add('hidden');
            gameState.running = true;
            gameState.score = 0;
            gameState.wave = 1;
            gameState.combo = 0;
            gameState.scrollDistance = 0;
            gameState.nextWaveAt = 150;
            gameState.waveEnemies = 0;
            gameState.killedEnemies = 0;
            player.lives = 3;
            player.x = W / 2;
            player.y = H - 80;
            player.missiles = 5;
            player.powerups = {};
            bullets = [];
            enemies = [];
            particles = [];
            powerups = [];
            spawnWave();
            gameLoop();
        }

        function gameOver() {
            gameState.running = false;
            if (gameState.score > gameState.highscore) {
                gameState.highscore = gameState.score;
                localStorage.setItem('highscore', gameState.highscore);
            }
            const overlay = document.getElementById('overlay');
            overlay.innerHTML = `
                <h1>GAME OVER</h1>
                <p style="font-size: 24px;">Final Score: ${gameState.score}</p>
                <p>High Score: ${gameState.highscore}</p>
                <p>Wave Reached: ${gameState.wave}</p>
                <button id="restartBtn">PLAY AGAIN</button>
            `;
            overlay.classList.remove('hidden');
            document.getElementById('restartBtn').addEventListener('click', startGame);
        }

        // Spieler-Schuss
        function shoot() {
            if (player.shootCooldown > 0) return;
            
            playSound(800, 0.1, 'square');
            
            if (player.powerups.spreadShot) {
                // Spread Shot - 5 Kugeln
                for (let i = -2; i <= 2; i++) {
                    bullets.push({
                        x: player.x,
                        y: player.y,
                        vx: i * 2,
                        vy: -8,
                        width: 4,
                        height: 12,
                        damage: 1,
                        color: '#0ff'
                    });
                }
                player.shootCooldown = 15;
            } else if (player.powerups.rapidFire) {
                bullets.push({
                    x: player.x - 8,
                    y: player.y,
                    vx: 0,
                    vy: -10,
                    width: 4,
                    height: 12,
                    damage: 1,
                    color: '#0ff'
                });
                bullets.push({
                    x: player.x + 8,
                    y: player.y,
                    vx: 0,
                    vy: -10,
                    width: 4,
                    height: 12,
                    damage: 1,
                    color: '#0ff'
                });
                player.shootCooldown = 8;
            } else {
                bullets.push({
                    x: player.x,
                    y: player.y,
                    vx: 0,
                    vy: -10,
                    width: 4,
                    height: 12,
                    damage: 1,
                    color: '#0ff'
                });
                player.shootCooldown = 12;
            }
        }

        // Raketen-Schuss
        function shootMissile() {
            if (player.missiles <= 0 || player.missileCooldown > 0) return;
            
            player.missiles--;
            player.missileCooldown = 60;
            playSound(400, 0.2, 'sawtooth');
            
            bullets.push({
                x: player.x,
                y: player.y,
                vx: 0,
                vy: -6,
                width: 8,
                height: 16,
                damage: 5,
                color: '#f00',
                missile: true,
                trail: []
            });
        }

        // Wellen-System
        function spawnWave() {
            const wave = gameState.wave;
            let enemyCount = 3 + wave; // Startet mit 4 Gegnern, dann +1 pro Welle
            gameState.waveEnemies += enemyCount;

            // Boss-Level alle 5 Wellen
            if (wave % 5 === 0) {
                spawnBoss();
                gameState.nextWaveAt = gameState.scrollDistance + 150;
                return;
            }

            // Formation wählen
            const formations = ['line', 'v', 'circle', 'grid'];
            const formation = formations[Math.floor(Math.random() * formations.length)];

            switch (formation) {
                case 'line':
                    spawnLineFormation(enemyCount);
                    break;
                case 'v':
                    spawnVFormation(enemyCount);
                    break;
                case 'circle':
                    spawnCircleFormation(enemyCount);
                    break;
                case 'grid':
                    spawnGridFormation(enemyCount);
                    break;
            }
            
            gameState.nextWaveAt = gameState.scrollDistance + 150;
        }

        function spawnLineFormation(count) {
            const spacing = W / (count + 1);
            for (let i = 0; i < count; i++) {
                const type = Math.random();
                let enemyType = 'standard';
                if (type > 0.7 && gameState.wave > 2) enemyType = 'fast';
                if (type > 0.85 && gameState.wave > 3) enemyType = 'chaser';
                if (type > 0.95 && gameState.wave > 5) enemyType = 'splitter';
                
                enemies.push(createEnemy(spacing * (i + 1), -50, enemyType));
            }
        }

        function spawnVFormation(count) {
            const half = Math.floor(count / 2);
            for (let i = 0; i < half; i++) {
                enemies.push(createEnemy(W / 2 - i * 60, -50 - i * 40, 'standard'));
                enemies.push(createEnemy(W / 2 + i * 60, -50 - i * 40, 'standard'));
            }
        }

        function spawnCircleFormation(count) {
            const centerX = W / 2;
            const centerY = -100;
            const radius = 80;
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2;
                enemies.push(createEnemy(
                    centerX + Math.cos(angle) * radius,
                    centerY + Math.sin(angle) * radius,
                    'standard'
                ));
            }
        }

        function spawnGridFormation(count) {
            const cols = Math.ceil(Math.sqrt(count));
            const rows = Math.ceil(count / cols);
            const spacingX = W / (cols + 1);
            const spacingY = 50;
            
            for (let i = 0; i < count; i++) {
                const col = i % cols;
                const row = Math.floor(i / cols);
                enemies.push(createEnemy(
                    spacingX * (col + 1),
                    -50 - row * spacingY,
                    'standard'
                ));
            }
        }

        function createEnemy(x, y, type) {
            const enemy = {
                x: x,
                y: y,
                type: type,
                shootCooldown: Math.random() * 120 + 60
            };

            switch (type) {
                case 'standard':
                    enemy.width = 30;
                    enemy.height = 30;
                    enemy.speed = 1 + gameState.wave * 0.1;
                    enemy.hp = 1;
                    enemy.color = '#f00';
                    enemy.points = 100;
                    break;
                case 'fast':
                    enemy.width = 25;
                    enemy.height = 25;
                    enemy.speed = 2.5 + gameState.wave * 0.15;
                    enemy.hp = 1;
                    enemy.color = '#ff0';
                    enemy.points = 150;
                    enemy.vx = (Math.random() - 0.5) * 3;
                    break;
                case 'chaser':
                    enemy.width = 35;
                    enemy.height = 35;
                    enemy.speed = 1.5 + gameState.wave * 0.1;
                    enemy.hp = 2;
                    enemy.color = '#f0f';
                    enemy.points = 200;
                    break;
                case 'splitter':
                    enemy.width = 40;
                    enemy.height = 40;
                    enemy.speed = 1 + gameState.wave * 0.08;
                    enemy.hp = 2;
                    enemy.color = '#0f0';
                    enemy.points = 250;
                    break;
            }

            return enemy;
        }

        function spawnBoss() {
            gameState.waveEnemies += 1;
            const boss = {
                x: W / 2,
                y: -100,
                width: 80,
                height: 80,
                speed: 0.5,
                hp: 50 + gameState.wave * 10,
                maxHp: 50 + gameState.wave * 10,
                type: 'boss',
                color: '#f0f',
                points: 2000,
                phase: 1,
                shootCooldown: 30,
                movePattern: 0,
                moveTimer: 0
            };
            enemies.push(boss);
        }

        // Gegner-Updates
        function updateEnemies() {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];

                // Bewegung je nach Typ
                switch (enemy.type) {
                    case 'standard':
                        enemy.y += enemy.speed;
                        break;
                    case 'fast':
                        enemy.y += enemy.speed;
                        enemy.x += enemy.vx || 0;
                        if (enemy.x < 0 || enemy.x > W) enemy.vx *= -1;
                        break;
                    case 'chaser':
                        const dx = player.x - enemy.x;
                        const dy = player.y - enemy.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        enemy.x += (dx / dist) * enemy.speed * 0.7;
                        enemy.y += (dy / dist) * enemy.speed * 0.5;
                        break;
                    case 'boss':
                        enemy.moveTimer++;
                        if (enemy.y < 100) {
                            enemy.y += enemy.speed;
                        } else {
                            // Boss-Bewegungsmuster
                            if (enemy.moveTimer % 120 < 60) {
                                enemy.x += Math.sin(enemy.moveTimer * 0.05) * 2;
                            } else {
                                enemy.x += Math.cos(enemy.moveTimer * 0.03) * 3;
                            }
                        }
                        enemy.x = Math.max(enemy.width, Math.min(W - enemy.width, enemy.x));
                        break;
                }

                // Gegner schießen
                if (enemy.shootCooldown > 0) {
                    enemy.shootCooldown--;
                } else {
                    enemyShoot(enemy);
                    enemy.shootCooldown = enemy.type === 'boss' ? 20 : 120 + Math.random() * 60;
                }

                // Gegner außerhalb des Bildschirms entfernen
                if (enemy.y > H + 50 && enemy.type !== 'boss') {
                    enemies.splice(i, 1);
                }
            }
        }

        function enemyShoot(enemy) {
            if (enemy.type === 'boss') {
                // Boss schießt Pattern
                const angleToPlayer = Math.atan2(player.y - enemy.y, player.x - enemy.x);
                for (let i = -1; i <= 1; i++) {
                    bullets.push({
                        x: enemy.x,
                        y: enemy.y + enemy.height / 2,
                        vx: Math.cos(angleToPlayer + i * 0.3) * 4,
                        vy: Math.sin(angleToPlayer + i * 0.3) * 4,
                        width: 6,
                        height: 6,
                        damage: 1,
                        color: '#f0f',
                        enemy: true
                    });
                }
            } else if (Math.random() > 0.7) {
                bullets.push({
                    x: enemy.x,
                    y: enemy.y + enemy.height,
                    vx: 0,
                    vy: 4,
                    width: 5,
                    height: 10,
                    damage: 1,
                    color: '#f00',
                    enemy: true
                });
            }
        }

        // Kollisionserkennung
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }

        // Power-up System
        function spawnPowerup(x, y) {
            if (Math.random() > 0.3) return;
            
            const types = ['rapidFire', 'spreadShot', 'shield', 'health', 'missiles'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            powerups.push({
                x: x,
                y: y,
                width: 25,
                height: 25,
                type: type,
                vy: 2
            });
        }

        function applyPowerup(type) {
            playSound(600, 0.3, 'sine');
            
            switch (type) {
                case 'rapidFire':
                    player.powerups.rapidFire = 600;
                    break;
                case 'spreadShot':
                    player.powerups.spreadShot = 600;
                    break;
                case 'shield':
                    player.powerups.shield = 600;
                    player.invulnerable = 600;
                    break;
                case 'health':
                    if (player.lives < 5) player.lives++;
                    break;
                case 'missiles':
                    player.missiles = Math.min(10, player.missiles + 3);
                    break;
            }
        }

        // Partikel-Effekte
        function createExplosion(x, y, color, count = 20) {
            playSound(200, 0.2, 'sawtooth');
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2;
                const speed = Math.random() * 3 + 2;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 60,
                    maxLife: 60,
                    color: color,
                    size: Math.random() * 4 + 2
                });
            }
        }

        // Update-Funktion
        function update() {
            if (!gameState.running) return;

            // Scroll-Distanz erhöhen (basierend auf durchschnittlicher Bewegung)
            gameState.scrollDistance += 1;
            
            // Prüfen ob neue Welle spawnen soll
            if (gameState.scrollDistance >= gameState.nextWaveAt) {
                gameState.wave++;
                spawnWave();
            }

            // Spieler-Bewegung
            if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
            if (keys['d'] || keys['arrowright']) player.x += player.speed;
            if (keys['w'] || keys['arrowup']) player.y -= player.speed;
            if (keys['s'] || keys['arrowdown']) player.y += player.speed;

            player.x = Math.max(15, Math.min(W - 15, player.x));
            player.y = Math.max(20, Math.min(H - 20, player.y));

            if (player.shootCooldown > 0) player.shootCooldown--;
            if (player.missileCooldown > 0) player.missileCooldown--;
            if (player.invulnerable > 0) player.invulnerable--;

            // Power-ups Timer
            for (let key in player.powerups) {
                if (player.powerups[key] > 0) {
                    player.powerups[key]--;
                    if (player.powerups[key] === 0) delete player.powerups[key];
                }
            }

            // Combo-Timer
            if (gameState.comboTimer > 0) {
                gameState.comboTimer--;
                if (gameState.comboTimer === 0) gameState.combo = 0;
            }

            // Sterne bewegen
            stars.forEach(star => {
                star.y += star.speed;
                if (star.y > H) {
                    star.y = 0;
                    star.x = Math.random() * W;
                }
            });

            // Kugeln updaten
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;

                // Trail für Raketen
                if (bullet.missile) {
                    bullet.trail.push({x: bullet.x, y: bullet.y});
                    if (bullet.trail.length > 10) bullet.trail.shift();
                }

                if (bullet.y < -20 || bullet.y > H + 20 || bullet.x < -20 || bullet.x > W + 20) {
                    bullets.splice(i, 1);
                    continue;
                }

                // Kollision mit Gegnern (Spieler-Kugeln)
                if (!bullet.enemy) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        if (checkCollision(bullet, enemies[j])) {
                            enemies[j].hp -= bullet.damage;
                            bullets.splice(i, 1);
                            
                            if (enemies[j].hp <= 0) {
                                const enemy = enemies[j];
                                const points = enemy.points * (1 + gameState.combo * 0.1);
                                gameState.score += Math.floor(points);
                                gameState.combo++;
                                gameState.comboTimer = 120;
                                
                                createExplosion(enemy.x, enemy.y, enemy.color);
                                
                                // Splitter-Mechanik
                                if (enemy.type === 'splitter') {
                                    for (let k = 0; k < 3; k++) {
                                        const mini = createEnemy(enemy.x, enemy.y, 'fast');
                                        mini.width = 15;
                                        mini.height = 15;
                                        mini.points = 50;
                                        mini.vx = (Math.random() - 0.5) * 4;
                                        enemies.push(mini);
                                        gameState.waveEnemies++;
                                    }
                                }
                                
                                spawnPowerup(enemy.x, enemy.y);
                                enemies.splice(j, 1);
                                gameState.killedEnemies++;
                            }
                            break;
                        }
                    }
                }
                // Kollision mit Spieler (Gegner-Kugeln)
                else {
                    if (checkCollision(bullet, player) && player.invulnerable === 0) {
                        bullets.splice(i, 1);
                        if (!player.powerups.shield) {
                            player.lives--;
                            player.invulnerable = 120;
                            createExplosion(player.x, player.y, '#0ff', 15);
                            if (player.lives <= 0) gameOver();
                        }
                    }
                }
            }

            // Gegner updaten
            updateEnemies();

            // Kollision Spieler-Gegner
            if (player.invulnerable === 0) {
                enemies.forEach(enemy => {
                    if (checkCollision(player, enemy) && !player.powerups.shield) {
                        player.lives--;
                        player.invulnerable = 120;
                        createExplosion(player.x, player.y, '#0ff', 15);
                        if (player.lives <= 0) gameOver();
                    }
                });
            }

            // Power-ups updaten
            for (let i = powerups.length - 1; i >= 0; i--) {
                powerups[i].y += powerups[i].vy;
                
                if (checkCollision(player, powerups[i])) {
                    applyPowerup(powerups[i].type);
                    powerups.splice(i, 1);
                } else if (powerups[i].y > H) {
                    powerups.splice(i, 1);
                }
            }

            // Partikel updaten
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].vx;
                particles[i].y += particles[i].vy;
                particles[i].life--;
                if (particles[i].life <= 0) particles.splice(i, 1);
            }

            updateUI();
        }

        // Render-Funktion
        function render() {
            // Hintergrund
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, W, H);

            // Sterne
            ctx.fillStyle = '#fff';
            stars.forEach(star => {
                ctx.fillRect(star.x, star.y, star.size, star.size);
            });

            // Partikel
            particles.forEach(p => {
                const alpha = p.life / p.maxLife;
                ctx.fillStyle = p.color + Math.floor(alpha * 255).toString(16).padStart(2, '0');
                ctx.fillRect(p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
            });

            // Kugeln
            bullets.forEach(bullet => {
                if (bullet.missile && bullet.trail) {
                    // Raketen-Trail
                    ctx.strokeStyle = bullet.color + '80';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    bullet.trail.forEach((pos, i) => {
                        if (i === 0) ctx.moveTo(pos.x, pos.y);
                        else ctx.lineTo(pos.x, pos.y);
                    });
                    ctx.stroke();
                }
                
                ctx.fillStyle = bullet.color;
                ctx.fillRect(bullet.x - bullet.width / 2, bullet.y - bullet.height / 2, bullet.width, bullet.height);
            });

            // Gegner
            enemies.forEach(enemy => {
                // Gegner-Körper
                ctx.fillStyle = enemy.color;
                
                if (enemy.type === 'boss') {
                    // Boss-Design
                    ctx.fillRect(enemy.x - enemy.width / 2, enemy.y - enemy.height / 2, enemy.width, enemy.height);
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(enemy.x - enemy.width / 2, enemy.y - enemy.height / 2, enemy.width, enemy.height);
                    
                    // HP-Balken
                    const hpPercent = enemy.hp / enemy.maxHp;
                    ctx.fillStyle = '#f00';
                    ctx.fillRect(enemy.x - 40, enemy.y - enemy.height / 2 - 15, 80, 8);
                    ctx.fillStyle = '#0f0';
                    ctx.fillRect(enemy.x - 40, enemy.y - enemy.height / 2 - 15, 80 * hpPercent, 8);
                } else {
                    // Standard-Gegner
                    ctx.beginPath();
                    ctx.moveTo(enemy.x, enemy.y - enemy.height / 2);
                    ctx.lineTo(enemy.x - enemy.width / 2, enemy.y + enemy.height / 2);
                    ctx.lineTo(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
                    ctx.closePath();
                    ctx.fill();
                }
            });

            // Power-ups
            powerups.forEach(p => {
                const colors = {
                    rapidFire: '#ff0',
                    spreadShot: '#0ff',
                    shield: '#00f',
                    health: '#0f0',
                    missiles: '#f0f'
                };
                ctx.fillStyle = colors[p.type];
                ctx.fillRect(p.x - p.width / 2, p.y - p.height / 2, p.width, p.height);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(p.x - p.width / 2, p.y - p.height / 2, p.width, p.height);
            });

            // Spieler
            if (player.invulnerable === 0 || Math.floor(Date.now() / 100) % 2 === 0) {
                ctx.fillStyle = player.powerups.shield ? '#00f' : '#0ff';
                ctx.beginPath();
                ctx.moveTo(player.x, player.y - 20);
                ctx.lineTo(player.x - 15, player.y + 20);
                ctx.lineTo(player.x, player.y + 10);
                ctx.lineTo(player.x + 15, player.y + 20);
                ctx.closePath();
                ctx.fill();
                
                if (player.powerups.shield) {
                    ctx.strokeStyle = '#00f';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(player.x, player.y, 30, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('highscore').textContent = gameState.highscore;
            document.getElementById('wave').textContent = gameState.wave;
            document.getElementById('lives').textContent = player.lives;
            document.getElementById('combo').textContent = gameState.combo;

            // Power-up Anzeige
            const powerupBar = document.getElementById('powerupBar');
            powerupBar.innerHTML = '';
            
            for (let key in player.powerups) {
                const timeLeft = Math.ceil(player.powerups[key] / 60);
                const names = {
                    rapidFire: 'Rapid Fire',
                    spreadShot: 'Spread',
                    shield: 'Shield'
                };
                if (names[key]) {
                    const div = document.createElement('div');
                    div.className = 'powerup-item';
                    div.textContent = `${names[key]}: ${timeLeft}s`;
                    powerupBar.appendChild(div);
                }
            }
            
            if (player.missiles > 0) {
                const div = document.createElement('div');
                div.className = 'powerup-item';
                div.textContent = `Missiles: ${player.missiles}`;
                powerupBar.appendChild(div);
            }
        }

        function gameLoop() {
            if (!gameState.running) return;
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>
