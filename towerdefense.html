<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TD Master Edition</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#1e3c72,#2a5298);display:flex;justify-content:center;align-items:center;min-height:100vh;color:#fff;overflow:hidden}
#app{background:rgba(0,0,0,.9);border-radius:20px;padding:15px;max-width:95vw;position:relative}
#c{border:3px solid #4CAF50;border-radius:10px;display:block;background:#1a1a1a;cursor:crosshair}
.ui{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;font-size:12px}
.stat{background:rgba(255,255,255,.1);padding:6px 10px;border-radius:6px;font-weight:bold}
.btns{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.btn{padding:8px 14px;font-size:12px;font-weight:bold;border:none;border-radius:6px;cursor:pointer;transition:.3s}
.btn:disabled{opacity:.5;cursor:not-allowed}
.towers{display:flex;gap:5px;background:rgba(255,255,255,.1);padding:5px;border-radius:8px;flex-wrap:wrap}
.tw{padding:5px 8px;background:rgba(255,255,255,.2);border:2px solid transparent;border-radius:5px;cursor:pointer;font-size:10px;color:#fff}
.tw:hover{background:rgba(255,255,255,.3)}
.tw.sel{border-color:#4CAF50;background:rgba(76,175,80,.3)}
.tw.locked{opacity:.4;cursor:not-allowed}
.panel{position:absolute;background:rgba(0,0,0,.95);border:3px solid #4CAF50;border-radius:12px;padding:12px;display:none;z-index:50;min-width:180px}
.panel.show{display:block}
.upg{width:100%;margin:3px 0;padding:6px;background:#4CAF50;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:11px;font-weight:bold}
.upg:hover{background:#45a049}
.upg:disabled{background:#666}
.modal{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.95);padding:25px;border-radius:15px;text-align:center;display:none;z-index:100;border:3px solid #f44;max-width:350px}
.modal.show{display:block}
.modal.win{border-color:#4CAF50}
.tip{position:absolute;background:rgba(0,0,0,.9);color:#fff;padding:8px;border-radius:6px;font-size:10px;display:none;z-index:60;border:1px solid #4CAF50;max-width:180px}
.modes{display:flex;gap:5px;margin-bottom:8px}
.mode{flex:1;padding:8px;background:rgba(255,255,255,.2);border:2px solid transparent;border-radius:6px;cursor:pointer;font-size:11px;font-weight:bold}
.mode.sel{border-color:#4CAF50}
.quest{background:rgba(255,215,0,.2);border:2px solid #FFD700;padding:5px;margin:3px 0;border-radius:4px;font-size:10px}
.info{font-size:10px;color:rgba(255,255,255,.6);text-align:center;margin-top:5px}
</style>
</head>
<body>
<div id="app">
    <div class="modes">
        <button class="mode sel" data-mode="survival">üéØ Survival</button>
        <button class="mode" data-mode="challenge">‚ö° Challenge</button>
        <button class="mode" data-mode="endless">‚ôæÔ∏è Endless</button>
    </div>
    <div class="ui">
        <div class="stat">üí∞<span id="m">300</span></div>
        <div class="stat">‚ù§Ô∏è<span id="lv">30</span></div>
        <div class="stat">üåä<span id="w">0</span></div>
        <div class="stat">‚≠ê<span id="xp">0</span></div>
        <div class="stat">üèÜ<span id="hs">0</span></div>
    </div>
    <canvas id="c" width="800" height="600"></canvas>
    <div class="btns">
        <button class="btn" id="sb" style="background:#4CAF50;color:#fff;flex:1">Start</button>
        <button class="btn" id="fb" style="background:#00BCD4;color:#fff">‚ùÑÔ∏è<span id="fc"></span></button>
        <button class="btn" id="bb" style="background:#F44336;color:#fff">üí£<span id="bc"></span></button>
        <button class="btn" id="lb" style="background:#FFEB3B;color:#000">‚ö°<span id="lc"></span></button>
        <button class="btn" id="mb" style="background:#9C27B0;color:#fff">üîÆ<span id="mc"></span></button>
    </div>
    <div class="towers" id="tws"></div>
    <div class="info">Hover=Range ‚Ä¢ Click=Upgrade ‚Ä¢ XP unlocks towers</div>
</div>

<div class="panel" id="panel">
    <h4 id="pn" style="margin:0 0 5px"></h4>
    <p id="ps" style="font-size:10px;margin-bottom:5px"></p>
    <button class="upg" id="ud">+DMG($30)</button>
    <button class="upg" id="ur">+Range($40)</button>
    <button class="upg" id="us">+Speed($35)</button>
    <button class="upg" id="uu" style="display:none">Ultimate($100)</button>
    <button class="upg" style="background:#f44" id="sell">Sell(50%)</button>
    <button class="btn" style="width:100%;margin-top:3px;background:#666;font-size:11px" onclick="closeP()">X</button>
</div>

<div class="modal" id="modal">
    <h2 id="mt" style="margin-bottom:10px"></h2>
    <div id="ms" style="margin:10px 0;line-height:1.6"></div>
    <div id="qs"></div>
    <button class="btn" style="background:#4CAF50;color:#fff;padding:10px 30px" onclick="location.reload()">Again</button>
</div>

<div class="tip" id="tip"></div>

<script>
// --- BASIC VARIABLES ---
const c = document.getElementById('c');
const x = c.getContext('2d');
const G = 40; // grid size
let path = [{x:0,y:7},{x:3,y:7},{x:3,y:3},{x:7,y:3},{x:7,y:11},{x:12,y:11},{x:12,y:5},{x:16,y:5},{x:16,y:10},{x:19,y:10}];
let m = 300, lv = 30, w = 0, xp = 0, hs = 0;
let sel = 'basic', act = 0, run = 1, tws = [], ens = [], selT = null, hov = null;
let fcd = 0, bcd = 0, lcd = 0, mcd = 0;
let unlk = {basic:1,fire:1,sniper:1,splash:1};
let mode = 'survival';

// --- TOWER & ENEMY DATA (gek√ºrzt f√ºr √úbersicht) ---
const TW = { basic:{c:50,d:10,r:100,f:1000,col:'#4CAF50',p:'#8BC34A',u:0} };
const EN = { norm:{h:30,s:1.2,r:12,x:5,c:'#e74c3c',sz:12} };

// --- SIMPLE TOWER CLASS ---
class Tower {
    constructor(xx,yy,t){
        this.x = xx; this.y = yy; this.t = t; this.s = {...TW[t]}; this.lf = 0; this.tg = null; this.lv = 1; this.rot = 0; this.cost=this.s.c; this.ult=0;
    }
    draw(){
        const px=this.x*G+G/2,py=this.y*G+G/2;
        x.save(); x.translate(px,py); x.rotate(this.rot);
        x.fillStyle=this.s.col; x.beginPath(); x.arc(0,0,G*.35,0,Math.PI*2); x.fill(); x.restore();
    }
    update(t){
        if(!ens.length) return;
        this.tg = ens[0];
        this.rot = Math.atan2(this.tg.y-(this.y*G+G/2),this.tg.x-(this.x*G+G/2));
        if(t-this.lf>this.s.f){ this.fire(); this.lf=t; }
    }
    fire(){
        if(!this.tg) return;
        this.tg.h -= this.s.d;
    }
    upg(t){ if(m<this.s.c) return; m-=this.s.c; this.lv++; this.s.d+=5; }
    sell(){ m+=Math.floor(this.cost*.5); }
}

// --- SIMPLE ENEMY CLASS ---
class Enemy {
    constructor(){
        const s=EN['norm']; this.h=s.h; this.s=s.s; this.x=path[0].x*G+G/2; this.y=path[0].y*G+G/2; this.pi=0;
    }
    update(){
        if(this.pi>=path.length-1) { lv--; return true; }
        const cu=path[this.pi], nx=path[this.pi+1];
        const dx=nx.x*G+G/2-this.x, dy=nx.y*G+G/2-this.y, d=Math.hypot(dx,dy);
        if(d<this.s){ this.pi++; return false; }
        this.x += (dx/d)*this.s; this.y += (dy/d)*this.s; return false;
    }
    draw(){ x.fillStyle='#e74c3c'; x.beginPath(); x.arc(this.x,this.y,12,0,Math.PI*2); x.fill(); }
}

// --- CANVAS EVENTS ---
c.addEventListener('click', e => {
    const rt = c.getBoundingClientRect();
    const gx = Math.floor((e.clientX-rt.left)/G);
    const gy = Math.floor((e.clientY-rt.top)/G);
    const clickedTower = tws.find(t => t.x===gx && t.y===gy);
    if(clickedTower){ selT = clickedTower; showP(clickedTower, e.clientX, e.clientY); return; }
    const onPath = path.some(p=>p.x===gx && p.y===gy);
    const towerExists = tws.some(t=>t.x===gx && t.y===gy);
    if(!onPath && !towerExists && m>=TW[sel].c){ tws.push(new Tower(gx,gy,sel)); m-=TW[sel].c; }
});
c.addEventListener('mousemove', e => {
    const rt = c.getBoundingClientRect();
    const gx = Math.floor((e.clientX-rt.left)/G);
    const gy = Math.floor((e.clientY-rt.top)/G);
    const tw = tws.find(t => t.x===gx && t.y===gy);
    const tip = document.getElementById('tip');
    if(tw){ tip.style.display='block'; tip.style.left=e.clientX+10+'px'; tip.style.top=e.clientY+10+'px'; tip.innerHTML=`<b>${tw.t} Lv${tw.lv}</b>`; }
    else tip.style.display='none';
});

// --- UI BUTTONS ---
document.getElementById('ud').onclick=()=>{ if(selT) selT.upg('d'); showP(selT,selT.x*G,selT.y*G); };
document.getElementById('sell').onclick=()=>{ if(selT){ selT.sell(); tws = tws.filter(t=>t!==selT); closeP(); } };
document.getElementById('sb').onclick = ()=>{ act=1; w++; };

// --- PANEL ---
function showP(t,xx,yy){ const p=document.getElementById('panel'); p.classList.add('show'); p.style.left=xx+'px'; p.style.top=yy+'px'; document.getElementById('pn').textContent = t.t+' Lv'+t.lv; }
function closeP(){ document.getElementById('panel').classList.remove('show'); selT=null; }

// --- GAME LOOP ---
function loop(t){
    x.clearRect(0,0,c.width,c.height);
    // draw path
    x.strokeStyle='#888'; x.lineWidth=5; x.beginPath();
    x.moveTo(path[0].x*G+G/2, path[0].y*G+G/2);
    for(let p of path) x.lineTo(p.x*G+G/2, p.y*G+G/2);
    x.stroke();

    // update towers
    tws.forEach(tw=>{ tw.update(t); tw.draw(); });

    // update enemies
    ens = ens.filter(e=>!e.update());
    ens.forEach(e=>e.draw());

    document.getElementById('m').textContent = m;
    document.getElementById('lv').textContent = lv;
    document.getElementById('w').textContent = w;
    requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
