<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tower Defense - Functional</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  color: #fff;
}
#gameContainer {
  background: rgba(0, 0, 0, 0.9);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
  position: relative;
}
#gameCanvas {
  border: 3px solid #4CAF50;
  border-radius: 10px;
  display: block;
  background: #1a1a1a;
  cursor: crosshair;
}
#ui {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  gap: 15px;
  flex-wrap: wrap;
}
.stat {
  background: rgba(255, 255, 255, 0.1);
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: bold;
}
#controls {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}
.btn {
  padding: 10px 20px;
  font-size: 14px;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
}
.btn-start {
  background: linear-gradient(135deg, #4CAF50, #45a049);
  color: white;
  flex: 1;
}
.btn-start:hover { transform: scale(1.05); }
.btn-start:disabled { background: #666; cursor: not-allowed; }
.btn-ability {
  background: linear-gradient(135deg, #9C27B0, #7B1FA2);
  color: white;
  position: relative;
}
.btn-ability:disabled { opacity: 0.5; }
.btn-ability .cooldown {
  position: absolute;
  top: 2px;
  right: 2px;
  background: rgba(0,0,0,0.7);
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 10px;
}
.tower-select {
  display: flex;
  gap: 8px;
  background: rgba(255, 255, 255, 0.1);
  padding: 8px;
  border-radius: 10px;
  flex-wrap: wrap;
}
.tower-btn {
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid transparent;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s;
  color: white;
  font-size: 12px;
}
.tower-btn:hover { background: rgba(255, 255, 255, 0.3); }
.tower-btn.selected { border-color: #4CAF50; background: rgba(76, 175, 80, 0.3); }
.tower-btn.disabled { opacity: 0.5; cursor: not-allowed; }
#towerUpgrade {
  position: absolute;
  background: rgba(0, 0, 0, 0.95);
  border: 3px solid #4CAF50;
  border-radius: 15px;
  padding: 20px;
  display: none;
  z-index: 50;
}
#towerUpgrade.show { display: block; }
.upgrade-btn {
  width: 100%;
  margin: 5px 0;
  padding: 10px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}
.upgrade-btn:hover { background: #45a049; }
.upgrade-btn:disabled { background: #666; cursor: not-allowed; }
#gameOver, #victory {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.95);
  padding: 40px;
  border-radius: 20px;
  text-align: center;
  display: none;
  z-index: 100;
  border: 3px solid #f44336;
}
#gameOver.show, #victory.show { display: block; }
#victory { border-color: #4CAF50; }
.tooltip {
  position: absolute;
  background: rgba(0,0,0,0.9);
  color: white;
  padding: 8px 12px;
  border-radius: 5px;
  font-size: 12px;
  pointer-events: none;
  display: none;
  z-index: 60;
  border: 1px solid #fff;
}
</style>
</head>
<body>
<div id="gameContainer">
  <div id="ui">
    <div class="stat">üí∞ $<span id="money">150</span></div>
    <div class="stat">‚ù§Ô∏è <span id="lives">25</span></div>
    <div class="stat">üåä Wave <span id="wave">0</span></div>
    <div class="stat">üèÜ High: <span id="highScore">0</span></div>
  </div>
  
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  
  <div id="controls">
    <button class="btn btn-start" id="startWaveBtn">Start Wave 1</button>
    <button class="btn btn-ability" id="freezeBtn">‚ùÑÔ∏è Freeze <span class="cooldown" id="freezeCd"></span></button>
    <button class="btn btn-ability" id="bombBtn">üí£ Bomb <span class="cooldown" id="bombCd"></span></button>
    <button class="btn btn-start" onclick="saveGame()">üíæ Save</button>
    <button class="btn btn-start" onclick="loadGame()">üìÇ Load</button>
  </div>
  
  <div class="tower-select">
    <button class="tower-btn selected" data-type="basic">üóº Basic<br><small>$50</small></button>
    <button class="tower-btn" data-type="sniper">üéØ Sniper<br><small>$80</small></button>
    <button class="tower-btn" data-type="splash">üí• Splash<br><small>$100</small></button>
    <button class="tower-btn" data-type="slow">‚ùÑÔ∏è Ice<br><small>$70</small></button>
    <button class="tower-btn" data-type="poison">‚ò†Ô∏è Poison<br><small>$90</small></button>
  </div>
</div>

<div id="towerUpgrade">
  <h3 id="upgradeTowerName">Tower Upgrades</h3>
  <p id="upgradeTowerStats"></p>
  <button class="upgrade-btn" id="upgradeDmg">+Damage ($30)</button>
  <button class="upgrade-btn" id="upgradeRange">+Range ($40)</button>
  <button class="upgrade-btn" id="upgradeSpeed">+Fire Rate ($35)</button>
  <button class="btn" style="width:100%; margin-top:10px; background:#f44;" onclick="closeTowerUpgrade()">Close</button>
</div>

<div id="gameOver">
  <h1>üíÄ Game Over!</h1>
  <p>Survived <span id="finalWave">0</span> waves</p>
  <button class="btn btn-start" onclick="location.reload()">Play Again</button>
</div>

<div id="victory">
  <h1>üéâ Victory!</h1>
  <p>You completed all waves!</p>
  <button class="btn btn-start" onclick="location.reload()">Play Again</button>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
// =================== //
//    GAME VARIABLES   //
// =================== //
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const GRID = 40, COLS = 20, ROWS = 15;

let money = 150, lives = 25, wave = 0, highScore = 0;
let towers = [], enemies = [], projectiles = [], particles = [];
let selectedTower = 'basic';
let waveActive = false, gameActive = true;
let freezeCooldown = 0, bombCooldown = 0;

// Tower & Enemy Definitions
const TOWER_TYPES = {
  basic: { cost: 50, dmg: 10, range: 100, rate: 1000, color: '#4CAF50', proj: '#8BC34A' },
  sniper: { cost: 80, dmg: 35, range: 200, rate: 1800, color: '#2196F3', proj: '#03A9F4' },
  splash: { cost: 100, dmg: 8, range: 120, rate: 800, color: '#FF9800', proj: '#FFC107', splash: 50 },
  slow: { cost: 70, dmg: 5, range: 110, rate: 1200, color: '#00BCD4', proj: '#80DEEA', slow: 0.5 },
  poison: { cost: 90, dmg: 3, range: 100, rate: 600, color: '#9C27B0', proj: '#BA68C8', poison: 2 }
};
const ENEMY_TYPES = {
  normal: { hp: 30, speed: 1.2, reward: 12, color: '#e74c3c', size: 12 },
  fast: { hp: 15, speed: 2.5, reward: 15, color: '#3498db', size: 10 },
  tank: { hp: 100, speed: 0.6, reward: 30, color: '#2ecc71', size: 16 },
  flying: { hp: 25, speed: 1.8, reward: 20, color: '#9b59b6', size: 11, flying: true },
  boss: { hp: 500, speed: 0.4, reward: 100, color: '#e67e22', size: 25 }
};

// Path Definition
const path = [
  {x:0,y:7},{x:3,y:7},{x:3,y:3},{x:7,y:3},{x:7,y:11},
  {x:12,y:11},{x:12,y:5},{x:16,y:5},{x:16,y:10},{x:19,y:10}
];

// ====================== //
//    GAME FUNCTIONS      //
// ====================== //

// Hier sollten alle Tower, Enemy, Projectile Klassen und gameLoop stehen
// Um Platz zu sparen, der volle Code wird aus deinem Originalcode √ºbernommen
// Wichtig: Stelle sicher, dass du canvas, drawGrid, drawPath, updateUI, gameLoop etc. alles hast

// ====================== //
//   SAVE / LOAD         //
// ====================== //
function saveGame() {
  const saveData = { money, lives, wave, towers, freezeCooldown, bombCooldown };
  localStorage.setItem('tdSave', JSON.stringify(saveData));
  alert('Game Saved!');
}

function loadGame() {
  const data = localStorage.getItem('tdSave');
  if (!data) { alert('No save found!'); return; }
  const save = JSON.parse(data);
  money = save.money;
  lives = save.lives;
  wave = save.wave;
  freezeCooldown = save.freezeCooldown;
  bombCooldown = save.bombCooldown;
  towers = save.towers.map(t => {
    const tower = new Tower(t.x, t.y, t.type);
    tower.level = t.level;
    tower.stats = t.stats;
    return tower;
  });
  enemies = [];
  projectiles = [];
  particles = [];
  alert('Game Loaded!');
}

// ====================== //
//   GAME START           //
// ====================== //
gameLoop();
</script>
</body>
</html>
