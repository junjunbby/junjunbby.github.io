<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini-Maze 2D</title>
<style>
body { margin:0; background:#222; font-family:sans-serif; }
canvas { display:block; margin:0 auto; background:#333; }
#ui {
  position:absolute; top:10px; left:10px; color:white;
  background: rgba(255,255,255,0.85); padding:10px; border-radius:6px;
  font-family:sans-serif;
}
</style>
</head>
<body>
<div id="ui">
<p id="status">Level: 1 | Score: 0 | Time: 30 | Highscore: 0</p>
</div>
<canvas id="gameCanvas" width="400" height="400"></canvas>

<!-- Sounds -->
<audio id="starSound" src="https://freesound.org/data/previews/320/320655_5260876-lq.mp3"></audio>
<audio id="trapSound" src="https://freesound.org/data/previews/198/198841_2859976-lq.mp3"></audio>
<audio id="levelUpSound" src="https://freesound.org/data/previews/146/146725_2615114-lq.mp3"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const tileSize = 40;

let gridSize = 5, level=1, score=0, timer=30;
let highscore = localStorage.getItem('miniMazeHighscore')||0;
let mazeMap=[], player={x:0,y:0}, exit={x:4,y:4};
let stars=[], traps=[];

generateMaze();
draw();

window.addEventListener('keydown', handleKey);
startTimer();

function playSound(id){ const audio=document.getElementById(id); if(audio){ audio.currentTime=0; audio.play(); } }

function generateMaze(){
    mazeMap = Array(gridSize).fill(0).map(()=>Array(gridSize).fill(0));
    stars=[]; traps=[];
    for(let y=0;y<gridSize;y++){
        for(let x=0;x<gridSize;x++){
            if(x===0 && y===0){ mazeMap[y][x]=0; continue; }
            if(x===gridSize-1 && y===gridSize-1){ mazeMap[y][x]=4; exit={x,y}; continue; }
            const r=Math.random();
            if(r<0.2){ mazeMap[y][x]=1; }
            else if(r<0.3){ mazeMap[y][x]=2; stars.push({x,y}); }
            else if(r<0.35){ mazeMap[y][x]=3; traps.push({x,y}); }
        }
    }
    player={x:0,y:0};
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<gridSize;y++){
        for(let x=0;x<gridSize;x++){
            if(mazeMap[y][x]===1){ ctx.fillStyle="#555"; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize); }
        }
    }
    // stars
    ctx.fillStyle="yellow"; stars.forEach(s=>ctx.fillRect(s.x*tileSize+10,s.y*tileSize+10,20,20));
    // traps
    ctx.fillStyle="blue"; traps.forEach(t=>ctx.fillRect(t.x*tileSize+10,t.y*tileSize+10,20,20));
    // exit
    ctx.fillStyle="green"; ctx.fillRect(exit.x*tileSize+5,exit.y*tileSize+5,30,30);
    // player
    ctx.fillStyle="red"; ctx.fillRect(player.x*tileSize+5,player.y*tileSize+5,30,30);
}

function handleKey(e){
    let dx=0,dy=0;
    if(e.key==='ArrowUp'||e.key==='w') dy=-1;
    else if(e.key==='ArrowDown'||e.key==='s') dy=1;
    else if(e.key==='ArrowLeft'||e.key==='a') dx=-1;
    else if(e.key==='ArrowRight'||e.key==='d') dx=1;
    movePlayer(dx,dy);
}

function canMove(x,y){ return x>=0 && y>=0 && x<gridSize && y<gridSize && mazeMap[y][x]!==1; }

function movePlayer(dx,dy){
    const nx=player.x+dx, ny=player.y+dy;
    if(!canMove(nx,ny)) return;
    player.x=nx; player.y=ny;
    // collect star
    for(let i=stars.length-1;i>=0;i--){
        if(stars[i].x===nx && stars[i].y===ny){ stars.splice(i,1); score+=10; playSound('starSound'); }
    }
    // trap
    traps.forEach(t=>{ if(t.x===nx && t.y===ny){ timer=Math.max(1,timer-5); playSound('trapSound'); } });
    // exit
    if(nx===exit.x && ny===exit.y){
        playSound('levelUpSound'); level++; gridSize=Math.min(gridSize+1,10);
        generateMaze();
    }
    updateStatus();
    draw();
}

function updateStatus(){
    if(score>highscore){ highscore=score; localStorage.setItem('miniMazeHighscore',highscore); }
    document.getElementById('status').textContent = `Level: ${level} | Score: ${score} | Time: ${timer} | Highscore: ${highscore}`;
}

function startTimer(){
    setInterval(()=>{
        timer--;
        if(timer<=0){ alert('Time up!'); score=0; timer=30; level=1; gridSize=5; generateMaze(); }
        updateStatus();
        draw();
    },1000);
}
</script>
</body>
</html>
